# Project Files Reference

Complete list of all files in the queuectl project with descriptions.

## Root Files

| File | Purpose | Lines |
|------|---------|-------|
| `package.json` | npm package configuration, dependencies | 30 |
| `README.md` | Main documentation with usage examples | 500+ |
| `QUICKSTART.md` | Quick start guide for new users | 200+ |
| `INSTALL.md` | Detailed installation instructions | 200+ |
| `ARCHITECTURE.md` | System architecture and design docs | 500+ |
| `PROJECT_FILES.md` | This file - project structure reference | - |
| `.gitignore` | Git ignore patterns | 10 |
| `.npmignore` | npm publish ignore patterns | 10 |
| `demo.sh` | Demo script for Unix/Linux/macOS | 50 |
| `demo.ps1` | Demo script for Windows PowerShell | 50 |

## Source Code - Core Services (`src/core/`)

| File | Purpose | Exports | Lines |
|------|---------|---------|-------|
| `storageService.js` | Database initialization & management | initDatabase, getDatabase, closeDatabase, transaction | 100 |
| `jobService.js` | Job CRUD operations, state management, locking | createJob, getJob, getJobsByState, acquireNextJob, completeJob, failJob, getQueueStats | 200 |
| `workerService.js` | Worker orchestration, job execution, retry logic | startWorkers, stopWorkers, getWorkerStatus, setupGracefulShutdown | 250 |
| `dlqService.js` | Dead letter queue management | listDeadJobs, retryDeadJob, retryAllDeadJobs, getDLQStats | 150 |
| `configService.js` | Configuration storage and retrieval | getConfig, setConfig, getAllConfig, getMaxRetries, getBackoffBase | 100 |

## Source Code - CLI Handlers (`src/cli/`)

| File | Purpose | Commands Handled | Lines |
|------|---------|------------------|-------|
| `enqueue.js` | Job enqueueing | `enqueue <json>` | 50 |
| `worker.js` | Worker management | `worker start`, `worker stop`, `worker status` | 80 |
| `status.js` | System status | `status` | 40 |
| `list.js` | Job listing | `list [--state]` | 80 |
| `dlq.js` | DLQ operations | `dlq list`, `dlq retry`, `dlq retry-all`, `dlq stats` | 120 |
| `config.js` | Configuration | `config get`, `config set` | 80 |

## Source Code - Entry Point (`src/`)

| File | Purpose | Lines |
|------|---------|-------|
| `app.js` | CLI entry point, Commander.js setup, command routing | 150 |

## Tests (`tests/`)

| File | Purpose | Lines |
|------|---------|-------|
| `test.js` | Comprehensive test suite for all features | 300 |

## Database Files (`src/db/`) - Auto-Generated

| File | Purpose | Generated By |
|------|---------|--------------|
| `queuectl.db` | SQLite database file | storageService.js on first run |
| `queuectl.db-wal` | Write-Ahead Log file | SQLite (WAL mode) |
| `queuectl.db-shm` | Shared memory file | SQLite (WAL mode) |
| `workers.json` | Worker state tracking | workerService.js |

## File Dependencies

```
app.js
├── cli/enqueue.js ──────┐
├── cli/worker.js ───────┤
├── cli/status.js ───────┤
├── cli/list.js ─────────┼──▶ core/jobService.js ────┐
├── cli/dlq.js ──────────┤   core/dlqService.js ─────┤
└── cli/config.js ───────┘   core/workerService.js ───┼──▶ core/storageService.js
                             core/configService.js ───┘          │
                                                                 ▼
                                                            Database
```

## Code Statistics

### Total Lines of Code

- **Core Services**: ~800 lines
- **CLI Handlers**: ~450 lines
- **Entry Point**: ~150 lines
- **Tests**: ~300 lines
- **Total**: ~1,700 lines of JavaScript

### File Count

- **JavaScript files**: 13
- **Documentation files**: 5
- **Configuration files**: 3
- **Demo scripts**: 2
- **Total**: 23 files

## Module Exports Quick Reference

### storageService.js
```javascript
import { initDatabase, getDatabase, closeDatabase, transaction } from './core/storageService.js';
```

### jobService.js
```javascript
import { 
  createJob, getJob, getJobsByState, getAllJobs,
  acquireNextJob, completeJob, failJob,
  getQueueStats, deleteJob, clearAllJobs
} from './core/jobService.js';
```

### workerService.js
```javascript
import { 
  startWorkers, stopWorkers, getWorkerStatus,
  setupGracefulShutdown
} from './core/workerService.js';
```

### dlqService.js
```javascript
import { 
  listDeadJobs, getDeadJob,
  retryDeadJob, retryAllDeadJobs,
  deleteDeadJob, deleteAllDeadJobs,
  getDLQStats
} from './core/dlqService.js';
```

### configService.js
```javascript
import { 
  getConfig, setConfig, getAllConfig,
  deleteConfig, getMaxRetries, getBackoffBase
} from './core/configService.js';
```

## Database Schema Quick Reference

### jobs table
```sql
- id (TEXT, PRIMARY KEY)
- command (TEXT)
- state (TEXT: pending|processing|completed|failed|dead)
- attempts (INTEGER)
- max_retries (INTEGER)
- created_at (TEXT, ISO timestamp)
- updated_at (TEXT, ISO timestamp)
- locked_by (TEXT, worker ID)
- locked_at (TEXT, ISO timestamp)
- result (TEXT)
- error (TEXT)
```

### config table
```sql
- key (TEXT, PRIMARY KEY)
- value (TEXT)
```

### workers table
```sql
- worker_id (TEXT, PRIMARY KEY)
- pid (INTEGER)
- status (TEXT)
- started_at (TEXT, ISO timestamp)
- last_heartbeat (TEXT, ISO timestamp)
```

## Key Features by File

### storageService.js
- SQLite database initialization
- WAL mode configuration
- Table creation (jobs, config, workers)
- Transaction support

### jobService.js
- Job CRUD operations
- Atomic job locking (prevents race conditions)
- State transitions
- Retry counter management
- Queue statistics

### workerService.js
- Multiple worker management
- Shell command execution (child_process.exec)
- Exponential backoff calculation
- Graceful shutdown (SIGINT/SIGTERM)
- Worker state persistence

### dlqService.js
- Dead job listing and filtering
- Job retry from DLQ
- Bulk retry operations
- DLQ statistics

### configService.js
- Key-value configuration storage
- Typed configuration getters
- Default value handling

## Entry Points

### CLI Entry Point
```bash
node src/app.js <command>
```

### Programmatic Entry Point
```javascript
import { initDatabase } from './src/core/storageService.js';
import { createJob } from './src/core/jobService.js';

initDatabase();
createJob({ id: 'job1', command: 'echo test' });
```

## Testing Entry Point
```bash
npm test
# or
node tests/test.js
```

---

**Last Updated:** 2025-01-15  
**Total Files:** 23  
**Total Lines:** ~1,700+ (code) + ~1,400+ (documentation)

